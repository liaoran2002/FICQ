(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0956a750"],{"26f6":function(e,t,s){"use strict";s("f611")},"5fcd":function(e,t,s){"use strict";s("70f1")},"63b9":function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e._self._c;return t("el-container",{staticClass:"friend-page"},[t("el-aside",{staticClass:"friend-list-box",attrs:{width:"260px"}},[t("div",{staticClass:"friend-list-header"},[t("el-input",{staticClass:"search-text",attrs:{size:"small",placeholder:"搜索"},model:{value:e.searchText,callback:function(t){e.searchText=t},expression:"searchText"}},[t("i",{staticClass:"el-icon-search el-input__icon",attrs:{slot:"prefix"},slot:"prefix"})]),t("el-button",{staticClass:"add-btn",attrs:{plain:"",icon:"el-icon-plus",title:"添加好友"},on:{click:function(t){return e.onShowAddFriend()}}}),t("add-friend",{attrs:{dialogVisible:e.showAddFriend},on:{close:e.onCloseAddFriend}})],1),t("el-scrollbar",{staticClass:"friend-list-items"},e._l(e.friendValues,(function(s,i){return t("div",{key:i},[t("div",{staticClass:"index-title"},[e._v(e._s(e.friendKeys[i]))]),e._l(s,(function(s){return t("div",{key:s.id},[t("friend-item",{attrs:{friend:s,active:s.id===e.activeFriend.id},on:{chat:function(t){return e.onSendMessage(s)},delete:function(t){return e.onDelFriend(s)}},nativeOn:{click:function(t){return e.onActiveItem(s)}}})],1)})),i<e.friendValues.length-1?t("div",{staticClass:"divider"}):e._e()],2)})),0)],1),t("el-container",{staticClass:"friend-box"},[t("div",{directives:[{name:"show",rawName:"v-show",value:e.userInfo.id,expression:"userInfo.id"}],staticClass:"friend-header"},[e._v(" "+e._s(e.userInfo.nickName)+" ")]),t("div",{directives:[{name:"show",rawName:"v-show",value:e.userInfo.id,expression:"userInfo.id"}]},[t("div",{staticClass:"friend-detail"},[t("head-image",{attrs:{size:160,name:e.userInfo.nickName,url:e.userInfo.headImage,radius:"10%"},nativeOn:{click:function(t){return e.showFullImage()}}}),t("div",[t("div",{staticClass:"info-item"},[t("el-descriptions",{staticClass:"description",attrs:{title:"好友信息",column:1}},[t("el-descriptions-item",{attrs:{label:"用户名"}},[e._v(e._s(e.userInfo.userName)+" ")]),t("el-descriptions-item",{attrs:{label:"昵称"}},[e._v(e._s(e.userInfo.nickName)+" ")]),t("el-descriptions-item",{attrs:{label:"性别"}},[e._v(e._s(0==e.userInfo.sex?"男":"女"))]),t("el-descriptions-item",{attrs:{label:"签名"}},[e._v(e._s(e.userInfo.signature))])],1)],1),t("div",{staticClass:"frient-btn-group"},[t("el-button",{directives:[{name:"show",rawName:"v-show",value:e.isFriend,expression:"isFriend"}],attrs:{icon:"el-icon-position",type:"primary"},on:{click:function(t){return e.onSendMessage(e.userInfo)}}},[e._v("发消息")]),t("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.isFriend,expression:"!isFriend"}],attrs:{icon:"el-icon-plus",type:"primary"},on:{click:function(t){return e.onAddFriend(e.userInfo)}}},[e._v("加为好友")]),t("el-button",{directives:[{name:"show",rawName:"v-show",value:e.isFriend,expression:"isFriend"}],attrs:{icon:"el-icon-delete",type:"danger"},on:{click:function(t){return e.onDelFriend(e.userInfo)}}},[e._v("删除好友")])],1)])],1)])])],1)},n=[],r=(s("14d9"),s("0643"),s("4e3e"),s("a573"),s("ff36")),a=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{title:"添加好友",visible:e.dialogVisible,width:"400px","before-close":e.onClose,"custom-class":"add-friend-dialog"},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("el-input",{staticClass:"input-with-select",attrs:{placeholder:"输入用户名或昵称按下 enter 搜索，最多展示 20 条",size:"small"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.onSearch()}},model:{value:e.searchText,callback:function(t){e.searchText=t},expression:"searchText"}},[t("i",{staticClass:"el-icon-search el-input__icon",attrs:{slot:"suffix"},on:{click:function(t){return e.onSearch()}},slot:"suffix"})]),t("div",{staticStyle:{display:"flex","justify-content":"space-between","align-items":"center","margin-top":"10px"}},[t("span",{staticStyle:{font:"600 20px"}},[e._v(e._s(e.isSearchResult?"搜索结果":"随机推荐"))]),t("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.isSearchResult,expression:"!isSearchResult"}],attrs:{type:"primary",size:"small"},on:{click:e.init}},[e._v("换一批")])],1),t("el-scrollbar",{staticStyle:{height:"400px"}},e._l(e.displayedUsers,(function(s){return t("div",{directives:[{name:"show",rawName:"v-show",value:s.id!=e.$store.state.userStore.userInfo.id,expression:"user.id != $store.state.userStore.userInfo.id"}],key:s.id},[t("div",{staticClass:"item"},[t("div",{staticClass:"avatar"},[t("head-image",{attrs:{name:s.nickName,url:s.headImage,online:s.online}})],1),t("div",{staticClass:"add-friend-text"},[t("div",{staticClass:"nick-name"},[t("div",{domProps:{innerHTML:e._s(e.highlightText(s.nickName,e.searchText))}}),t("div",{class:s.online?"online-status  online":"online-status"},[e._v(e._s(s.online?"[在线]":"[离线]"))])]),t("div",{staticClass:"user-name"},[t("div",[e._v("用户名:"),t("span",{domProps:{innerHTML:e._s(e.highlightText(s.userName,e.searchText))}})])])]),t("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.isFriend(s.id),expression:"!isFriend(user.id)"}],attrs:{type:"success",size:"mini"},on:{click:function(t){return e.onAddFriend(s)}}},[e._v("添加")]),t("el-button",{directives:[{name:"show",rawName:"v-show",value:e.isFriend(s.id),expression:"isFriend(user.id)"}],attrs:{type:"info",size:"mini",plain:"",disabled:""}},[e._v("已添加")])],1)])})),0)],1)},d=[],o=s("4036"),l={name:"addFriend",components:{HeadImage:o["a"]},data(){return{allUsers:[],displayedUsers:[],searchText:"",isSearchResult:!1,currentIndex:0}},props:{dialogVisible:{type:Boolean}},methods:{init(){this.isSearchResult||(0===this.allUsers.length?this.$http({url:"/user/randUsers",method:"get",params:{count:20}}).then(e=>{this.allUsers=e,this.displayedUsers=this.allUsers.slice(0,5),this.currentIndex=5}):(this.currentIndex>=this.allUsers.length&&(this.currentIndex=0),this.displayedUsers=this.allUsers.slice(this.currentIndex,this.currentIndex+5),this.currentIndex+=5))},onClose(){this.$emit("close"),this.searchText="",this.isSearchResult=!1,this.displayedUsers=this.allUsers.slice(0,5)},onSearch(){this.searchText?(this.isSearchResult=!0,this.$http({url:"/user/findByName",method:"get",params:{name:this.searchText}}).then(e=>{this.displayedUsers=e,this.currentIndex=0})):this.$message.error("请输入用户名或昵称")},onAddFriend(e){this.$http({url:"/friend/add",method:"post",params:{friendId:e.id}}).then(()=>{this.$message.success("添加成功，对方已成为您的好友");let t={id:e.id,nickName:e.nickName,headImage:e.headImage,online:e.online,deleted:!1};this.$store.commit("addFriend",t)})},isFriend(e){return this.$store.getters.isFriend(e)},highlightText(e,t){if(!t)return e;const s=new RegExp(`(${t})`,"gi");return e.replace(s,'<span class="highlight">$1</span>')}},mounted(){this.init()}},c=l,h=(s("5fcd"),s("2877")),u=Object(h["a"])(c,a,d,!1,null,null,null),m=u.exports,f=s("4371"),p={name:"friend",components:{FriendItem:r["a"],AddFriend:m,HeadImage:o["a"]},data(){return{searchText:"",showAddFriend:!1,userInfo:{},activeFriend:{}}},methods:{onShowAddFriend(){this.showAddFriend=!0},onCloseAddFriend(){this.showAddFriend=!1},onActiveItem(e){this.activeFriend=e,this.loadUserInfo(e.id)},onDelFriend(e){this.$confirm(`确认删除'${e.nickName}',并清空聊天记录吗?`,"确认解除?",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.$http({url:"/friend/delete/"+e.id,method:"delete"}).then(()=>{this.$message.success("删除好友成功"),this.$store.commit("removeFriend",e.id),this.$store.commit("removePrivateChat",e.id)})})},onAddFriend(e){this.$http({url:"/friend/add",method:"post",params:{friendId:e.id}}).then(()=>{this.$message.success("添加成功，对方已成为您的好友");let t={id:e.id,nickName:e.nickName,headImage:e.headImage,online:e.online};this.$store.commit("addFriend",t)})},onSendMessage(e){let t={type:"PRIVATE",targetId:e.id,showName:e.nickName,headImage:e.headImageThumb};console.log("chat:",t),this.$store.commit("openChat",t),this.$store.commit("activeChat",0),this.$router.push("/home/chat")},showFullImage(){this.userInfo.headImage&&this.$store.commit("showFullImageBox",this.userInfo.headImage)},updateFriendInfo(){if(this.isFriend){let e=JSON.parse(JSON.stringify(this.activeFriend));e.headImage=this.userInfo.headImageThumb,e.nickName=this.userInfo.nickName,this.$store.commit("updateChatFromFriend",e),this.$store.commit("updateFriend",e)}},loadUserInfo(e){this.$http({url:"/user/find/"+e,method:"GET"}).then(e=>{this.userInfo=e,this.updateFriendInfo()})},firstLetter(e){let t={toneType:"none",type:"normal"},s=Object(f["a"])(e,t);return s[0]},isEnglish(e){return/^[A-Za-z]+$/.test(e)}},computed:{friendStore(){return this.$store.state.friendStore},isFriend(){return this.$store.getters.isFriend(this.userInfo.id)},friendMap(){let e=new Map;this.friendStore.friends.forEach(t=>{if(t.deleted||this.searchText&&!t.nickName.includes(this.searchText))return;let s=this.firstLetter(t.nickName).toUpperCase();this.isEnglish(s)||(s="#"),t.online&&(s="在线"),e.has(s)?e.get(s).push(t):e.set(s,[t])});let t=Array.from(e);return t.sort((e,t)=>"#"==e[0]||"#"==t[0]?t[0].localeCompare(e[0]):e[0].localeCompare(t[0])),e=new Map(t.map(e=>[e[0],e[1]])),e},friendKeys(){return Array.from(this.friendMap.keys())},friendValues(){return Array.from(this.friendMap.values())}}},v=p,g=(s("26f6"),Object(h["a"])(v,i,n,!1,null,null,null));t["default"]=g.exports},"70f1":function(e,t,s){},f611:function(e,t,s){}}]);
//# sourceMappingURL=chunk-0956a750.fc097226.js.map