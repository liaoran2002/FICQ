(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1f7abdbb"],{2859:function(e,t,s){"use strict";var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"group-member"},[t("head-image",{attrs:{id:e.member.userId,name:e.member.showNickName,url:e.member.headImage,size:38,online:e.member.online}},[e.showDel?t("div",{staticClass:"btn-kick el-icon-error",on:{click:function(t){return t.stopPropagation(),e.onDelete()}}}):e._e()]),t("div",{staticClass:"member-name"},[e._v(e._s(e.member.showNickName))])],1)},i=[],a=s("4036"),o={name:"groupMember",components:{HeadImage:a["a"]},data(){return{}},props:{member:{type:Object,required:!0},showDel:{type:Boolean,default:!1}},methods:{onDelete(){this.$emit("del",this.member)}}},n=o,c=(s("8697"),s("2877")),l=Object(c["a"])(n,r,i,!1,null,null,null);t["a"]=l.exports},"29c2":function(e,t,s){},"5c36":function(e,t,s){"use strict";s.r(t);var r=function(){var e=this,t=e._self._c;return t("el-container",{staticClass:"group-page"},[t("el-aside",{staticClass:"group-list-box",attrs:{width:"260px"}},[t("div",{staticClass:"group-list-header"},[t("el-input",{staticClass:"search-text",attrs:{size:"small",placeholder:"搜索"},model:{value:e.searchText,callback:function(t){e.searchText=t},expression:"searchText"}},[t("i",{staticClass:"el-icon-search el-input__icon",attrs:{slot:"prefix"},slot:"prefix"})]),t("el-button",{staticClass:"add-btn",attrs:{plain:"",icon:"el-icon-plus",title:"创建群聊"},on:{click:function(t){return e.onCreateGroup()}}})],1),t("el-scrollbar",{staticClass:"group-list-items"},e._l(e.groupValues,(function(s,r){return t("div",{key:r},[t("div",{staticClass:"index-title"},[e._v(e._s(e.groupKeys[r]))]),e._l(s,(function(s){return t("div",{key:s.id},[t("group-item",{attrs:{group:s,active:s.id==e.activeGroup.id},nativeOn:{click:function(t){return e.onActiveItem(s)}}})],1)})),r<e.groupValues.length-1?t("div",{staticClass:"divider"}):e._e()],2)})),0)],1),t("el-container",{staticClass:"group-box"},[t("div",{directives:[{name:"show",rawName:"v-show",value:e.activeGroup.id,expression:"activeGroup.id"}],staticClass:"group-header"},[e._v(" "+e._s(e.activeGroup.showGroupName)+"("+e._s(e.groupMembers.length)+") ")]),t("div",{staticClass:"group-container"},[t("div",{directives:[{name:"show",rawName:"v-show",value:e.activeGroup.id,expression:"activeGroup.id"}]},[t("div",{staticClass:"group-info"},[t("div",[t("file-upload",{directives:[{name:"show",rawName:"v-show",value:e.isOwner,expression:"isOwner"}],staticClass:"avatar-uploader",attrs:{action:e.imageAction,showLoading:!0,maxSize:e.maxSize,fileTypes:["image/jpeg","image/png","image/jpg","image/webp"]},on:{success:e.onUploadSuccess}},[e.activeGroup.headImage?t("img",{staticClass:"avatar",attrs:{src:e.activeGroup.headImage}}):t("i",{staticClass:"el-icon-plus avatar-uploader-icon"})]),t("head-image",{directives:[{name:"show",rawName:"v-show",value:!e.isOwner,expression:"!isOwner"}],staticClass:"avatar",attrs:{size:160,url:e.activeGroup.headImage,name:e.activeGroup.showGroupName,radius:"10%"}}),t("el-button",{staticClass:"send-btn",attrs:{icon:"el-icon-position",type:"primary"},on:{click:function(t){return e.onSendMessage()}}},[e._v("发消息 ")])],1),t("el-form",{ref:"groupForm",staticClass:"group-form",attrs:{"label-width":"130px",model:e.activeGroup,rules:e.rules,size:"small"}},[t("el-form-item",{attrs:{label:"群聊名称",prop:"name"}},[t("el-input",{attrs:{disabled:!e.isOwner,maxlength:"20"},model:{value:e.activeGroup.name,callback:function(t){e.$set(e.activeGroup,"name",t)},expression:"activeGroup.name"}})],1),t("el-form-item",{attrs:{label:"群主"}},[t("el-input",{attrs:{value:e.ownerName,disabled:""}})],1),t("el-form-item",{attrs:{label:"群名备注"}},[t("el-input",{attrs:{placeholder:e.activeGroup.name,maxlength:"20"},model:{value:e.activeGroup.remarkGroupName,callback:function(t){e.$set(e.activeGroup,"remarkGroupName",t)},expression:"activeGroup.remarkGroupName"}})],1),t("el-form-item",{attrs:{label:"我在本群的昵称"}},[t("el-input",{attrs:{maxlength:"20",placeholder:e.$store.state.userStore.userInfo.nickName},model:{value:e.activeGroup.remarkNickName,callback:function(t){e.$set(e.activeGroup,"remarkNickName",t)},expression:"activeGroup.remarkNickName"}})],1),t("el-form-item",{attrs:{label:"群公告"}},[t("el-input",{attrs:{disabled:!e.isOwner,type:"textarea",rows:3,maxlength:"1024",placeholder:"群主未设置"},model:{value:e.activeGroup.notice,callback:function(t){e.$set(e.activeGroup,"notice",t)},expression:"activeGroup.notice"}})],1),t("div",[t("el-button",{directives:[{name:"show",rawName:"v-show",value:e.isOwner,expression:"isOwner"}],attrs:{type:"warning"},on:{click:function(t){return e.onInviteMember()}}},[e._v("邀请")]),t("el-button",{attrs:{type:"success"},on:{click:function(t){return e.onSaveGroup()}}},[e._v("保存")]),t("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.isOwner,expression:"!isOwner"}],attrs:{type:"danger"},on:{click:function(t){return e.onQuit()}}},[e._v("退出")]),t("el-button",{directives:[{name:"show",rawName:"v-show",value:e.isOwner,expression:"isOwner"}],attrs:{type:"danger"},on:{click:function(t){return e.onDissolve()}}},[e._v("解散")])],1)],1)],1),t("el-divider",{attrs:{"content-position":"center"}}),t("el-scrollbar",{ref:"scrollbar",style:"height: "+e.scrollHeight+"px"},[t("div",{staticClass:"group-member-list"},[t("div",{staticClass:"group-invite"},[t("div",{staticClass:"invite-member-btn",attrs:{title:"邀请好友进群聊"},on:{click:function(t){return e.onInviteMember()}}},[t("i",{staticClass:"el-icon-plus"})]),t("div",{staticClass:"invite-member-text"},[e._v("邀请")]),t("add-group-member",{attrs:{visible:e.showAddGroupMember,groupId:e.activeGroup.id,members:e.groupMembers},on:{reload:e.loadGroupMembers,close:e.onCloseAddGroupMember}})],1),e._l(e.showMembers,(function(s,r){return t("div",{key:s.id},[r<e.showMaxIdx?t("group-member",{staticClass:"group-member",attrs:{member:s,showDel:e.isOwner&&s.userId!=e.activeGroup.ownerId},on:{del:e.onKick}}):e._e()],1)}))],2)])],1)])])],1)},i=[],a=(s("14d9"),s("0643"),s("2382"),s("fffc"),s("4e3e"),s("a573"),function(){var e=this,t=e._self._c;return t("div",{staticClass:"group-item",class:e.active?"active":""},[t("div",{staticClass:"group-avatar"},[t("head-image",{attrs:{size:42,name:e.group.showGroupName,url:e.group.headImage}})],1),t("div",{staticClass:"group-name"},[t("div",[e._v(e._s(e.group.showGroupName))])])])}),o=[],n=s("4036"),c={name:"groupItem",components:{HeadImage:n["a"]},data(){return{}},props:{group:{type:Object},active:{type:Boolean}}},l=c,u=(s("ea72"),s("2877")),p=Object(u["a"])(l,a,o,!1,null,null,null),m=p.exports,d=s("1a05"),h=s("2859"),v=s("b242"),g=s("4371"),f={name:"group",components:{GroupItem:m,GroupMember:h["a"],FileUpload:d["a"],AddGroupMember:v["a"],HeadImage:n["a"]},data(){return{searchText:"",maxSize:5242880,activeGroup:{},groupMembers:[],showAddGroupMember:!1,showMaxIdx:150,rules:{name:[{required:!0,message:"请输入群聊名称",trigger:"blur"}]}}},methods:{onCreateGroup(){this.$prompt("请输入群聊名称","创建群聊",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/\S/,inputErrorMessage:"请输入群聊名称"}).then(e=>{this.$store.state.userStore.userInfo;let t={name:e.value};this.$http({url:"/group/create?groupName="+e.value,method:"post",data:t}).then(e=>{this.$store.commit("addGroup",e)})})},onActiveItem(e){this.showMaxIdx=150,this.activeGroup=JSON.parse(JSON.stringify(e)),this.loadGroupMembers()},onInviteMember(){this.showAddGroupMember=!0},onCloseAddGroupMember(){this.showAddGroupMember=!1},onUploadSuccess(e){this.activeGroup.headImage=e.originUrl,this.activeGroup.headImageThumb=e.thumbUrl},onSaveGroup(){this.$refs["groupForm"].validate(e=>{if(e){let e=this.activeGroup;this.$http({url:"/group/modify",method:"put",data:e}).then(e=>{this.$store.commit("updateGroup",e),this.$message.success("修改成功")})}})},onDissolve(){this.$confirm(`确认要解散'${this.activeGroup.name}'吗?`,"确认解散?",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.$http({url:"/group/delete/"+this.activeGroup.id,method:"delete"}).then(()=>{this.$message.success(`群聊'${this.activeGroup.name}'已解散`),this.$store.commit("removeGroup",this.activeGroup.id),this.reset()})})},onKick(e){this.$confirm(`确定将成员'${e.showNickName}'移出群聊吗？`,"确认移出?",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.$http({url:"/group/kick/"+this.activeGroup.id,method:"delete",params:{userId:e.userId}}).then(()=>{this.$message.success(`已将${e.showNickName}移出群聊`),e.quit=!0})})},onQuit(){this.$confirm(`确认退出'${this.activeGroup.showGroupName}',并清空聊天记录吗？`,"确认退出?",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.$http({url:"/group/quit/"+this.activeGroup.id,method:"delete"}).then(()=>{this.$message.success(`您已退出'${this.activeGroup.name}'`),this.$store.commit("removeGroup",this.activeGroup.id),this.$store.commit("removeGroupChat",this.activeGroup.id),this.reset()})})},onSendMessage(){let e={type:"GROUP",targetId:this.activeGroup.id,showName:this.activeGroup.showGroupName,headImage:this.activeGroup.headImage};this.$store.commit("openChat",e),this.$store.commit("activeChat",0),this.$router.push("/home/chat")},onScroll(e){const t=e.target;t.scrollTop+t.clientHeight>=t.scrollHeight-30&&this.showMaxIdx<this.showMembers.length&&(this.showMaxIdx+=50)},loadGroupMembers(){this.$http({url:"/group/members/"+this.activeGroup.id,method:"get"}).then(e=>{this.groupMembers=e})},reset(){this.activeGroup={},this.groupMembers=[]},firstLetter(e){let t={toneType:"none",type:"normal"},s=Object(g["a"])(e,t);return s[0]},isEnglish(e){return/^[A-Za-z]+$/.test(e)}},computed:{groupStore(){return this.$store.state.groupStore},ownerName(){let e=this.groupMembers.find(e=>e.userId==this.activeGroup.ownerId);return e&&e.showNickName},isOwner(){return this.activeGroup.ownerId==this.$store.state.userStore.userInfo.id},imageAction(){return"/image/upload"},groupMap(){let e=new Map;this.groupStore.groups.forEach(t=>{if(t.quit||this.searchText&&!t.showGroupName.includes(this.searchText))return;let s=this.firstLetter(t.showGroupName).toUpperCase();this.isEnglish(s)||(s="#"),e.has(s)?e.get(s).push(t):e.set(s,[t])});let t=Array.from(e);return t.sort((e,t)=>"#"==e[0]||"#"==t[0]?t[0].localeCompare(e[0]):e[0].localeCompare(t[0])),e=new Map(t.map(e=>[e[0],e[1]])),e},groupKeys(){return Array.from(this.groupMap.keys())},groupValues(){return Array.from(this.groupMap.values())},showMembers(){return this.groupMembers.filter(e=>!e.quit)},scrollHeight(){return Math.min(300,80+this.showMembers.length/10*80)}},mounted(){let e=this.$refs.scrollbar.$el.querySelector(".el-scrollbar__wrap");e.addEventListener("scroll",this.onScroll)}},b=f,w=(s("c0e6"),Object(u["a"])(b,r,i,!1,null,null,null));t["default"]=w.exports},8697:function(e,t,s){"use strict";s("9800")},9800:function(e,t,s){},b242:function(e,t,s){"use strict";var r=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{title:"邀请好友",visible:e.visible,width:"620px","before-close":e.onClose},on:{"update:visible":function(t){e.visible=t}}},[t("div",{staticClass:"agm-container"},[t("div",{staticClass:"agm-l-box"},[t("div",{staticClass:"search"},[t("el-input",{attrs:{placeholder:"搜索好友",size:"small"},model:{value:e.searchText,callback:function(t){e.searchText=t},expression:"searchText"}},[t("i",{staticClass:"el-icon-search el-input__icon",attrs:{slot:"suffix"},slot:"suffix"})])],1),t("el-scrollbar",{staticStyle:{height:"400px"}},e._l(e.friends,(function(s){return t("div",{key:s.id},[t("friend-item",{directives:[{name:"show",rawName:"v-show",value:s.nickName.includes(e.searchText),expression:"friend.nickName.includes(searchText)"}],attrs:{showDelete:!1,menu:!1,friend:s,active:!1},nativeOn:{click:function(t){return e.onSwitchCheck(s)}}},[t("el-checkbox",{staticClass:"agm-friend-checkbox",attrs:{disabled:s.disabled,size:"medium"},nativeOn:{click:function(e){e.stopPropagation()}},model:{value:s.isCheck,callback:function(t){e.$set(s,"isCheck",t)},expression:"friend.isCheck"}})],1)],1)})),0)],1),t("div",{staticClass:"agm-arrow el-icon-d-arrow-right"}),t("div",{staticClass:"agm-r-box"},[t("div",{staticClass:"agm-select-tip"},[e._v(" 已勾选"+e._s(e.checkCount)+"位好友")]),t("el-scrollbar",{staticStyle:{height:"400px"}},e._l(e.friends,(function(s){return t("div",{key:s.id},[s.isCheck&&!s.disabled?t("friend-item",{attrs:{friend:s,active:!1,menu:!1},on:{del:function(t){return e.onRemoveFriend(s)}}}):e._e()],1)})),0)],1)]),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){return e.onClose()}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.onOk()}}},[e._v("确 定")])],1)])},i=[],a=(s("14d9"),s("0643"),s("2382"),s("fffc"),s("4e3e"),s("ff36")),o={name:"addGroupMember",components:{FriendItem:a["a"]},data(){return{searchText:"",friends:[]}},methods:{onClose(){this.$emit("close")},onOk(){let e={groupId:this.groupId,friendIds:[]};this.friends.forEach(t=>{t.isCheck&&!t.disabled&&e.friendIds.push(t.id)}),e.friendIds.length>0&&this.$http({url:"/group/invite",method:"post",data:e}).then(()=>{this.$message.success("邀请成功"),this.$emit("reload"),this.$emit("close")})},onRemoveFriend(e){e.isCheck=!1},onSwitchCheck(e){e.disabled||(e.isCheck=!e.isCheck)}},props:{visible:{type:Boolean},groupId:{type:Number},members:{type:Array}},computed:{checkCount(){return this.friends.filter(e=>e.isCheck&&!e.disabled).length}},watch:{visible:function(e,t){e&&(this.friends=[],this.$store.state.friendStore.friends.forEach(e=>{if(e.deleted)return;let t=JSON.parse(JSON.stringify(e)),s=this.members.filter(e=>!e.quit).find(t=>t.userId==e.id);s?(t.disabled=!0,t.isCheck=!0):(t.disabled=!1,t.isCheck=!1),this.friends.push(t)}))}}},n=o,c=(s("d592"),s("2877")),l=Object(c["a"])(n,r,i,!1,null,null,null);t["a"]=l.exports},c0e6:function(e,t,s){"use strict";s("c4ee")},c4ee:function(e,t,s){},d592:function(e,t,s){"use strict";s("ee6a")},ea72:function(e,t,s){"use strict";s("29c2")},ee6a:function(e,t,s){}}]);
//# sourceMappingURL=chunk-1f7abdbb.514abce8.js.map